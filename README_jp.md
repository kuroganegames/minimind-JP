# miniMind: Micro intellignece great great potential

<div align="center">

![logo](./images/logo.png)

</div>

<div align="center">
![visitors](https://visitor-badge.laobi.icu/badge?page_id=jingyaogong/minimind)
[![GitHub Repo stars](https://img.shields.io/github/stars/jingyaogong/minimind?style=social)](https://github.com/jingyaogong/minimind/stargazers)
[![GitHub Code License](https://img.shields.io/github/license/jingyaogong/minimind)](LICENSE)
[![GitHub last commit](https://img.shields.io/github/last-commit/jingyaogong/minimind)](https://github.com/jingyaogong/minimind/commits/master)
[![GitHub pull request](https://img.shields.io/badge/PRs-welcome-blue)](https://github.com/jingyaogong/minimind/pulls)
[![Collection](https://img.shields.io/badge/ğŸ¤—-MiniMind%20%20Collection-blue)](https://huggingface.co/collections/jingyaogong/minimind-66caf8d999f5c7fa64f399e5)

</div>

<div align="center">
  <h3>ã€Œå¤§é“è‡³ç°¡ã€</h3>
  <p>"ã‚·ãƒ³ãƒ—ãƒ«ã•ã“ãç©¶æ¥µã®æ´—ç·´"</p>
</div>

<div align="center">
[ä¸­å›½èª](./README.md) | [English](./README_en.md) | [æ—¥æœ¬èª](./README_jp.md)

ã“ã®ãƒšãƒ¼ã‚¸ã¯æš«å®šçš„ãªæ—¥æœ¬èªç¿»è¨³ç‰ˆã§ã™ã€‚


</div>

* ã“ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€å®Œå…¨ã«ã‚¼ãƒ­ã‹ã‚‰å§‹ã‚ã¦ã€æœ€çŸ­ã§ã‚ãšã‹3æ™‚é–“ã®å­¦ç¿’ã§ã‚µã‚¤ã‚ºç´„26.88Mã®å°å‹è¨€èªãƒ¢ãƒ‡ãƒ« **MiniMind** ã‚’ä½œã‚Šä¸Šã’ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚  
* **MiniMind** ã¯éå¸¸ã«è»½é‡ã§ã€æœ€å°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚µã‚¤ã‚ºã¯ GPT-3 ã®ç´„ \(\frac{1}{7000}\) ç›¸å½“ã€‚ä¸€èˆ¬çš„ãªå€‹äººç”¨GPUã§ã‚‚ã€æ¨è«–ã‹ã‚‰å­¦ç¿’ã¾ã§ã‚¹ãƒ ãƒ¼ã‚ºã«ä½“é¨“ã§ãã‚‹ã‚ˆã†ã«å·¥å¤«ã•ã‚Œã¦ã„ã¾ã™ã€‚  
* **MiniMind** ã§ã¯ã€å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ã®æœ€å°æ§‹é€ ã€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã¨å‰å‡¦ç†ã€æ•™å¸«ã‚ã‚Šäº‹å‰å­¦ç¿’ï¼ˆPretrainï¼‰ã€æ•™å¸«ã‚ã‚Šãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆSFTï¼‰ã€ä½ãƒ©ãƒ³ã‚¯é©å¿œ(LoRA)æ‰‹æ³•ã€DPO(Direct Preference Optimization)ãªã©ã€å…¨æ®µéšã®ã‚³ãƒ¼ãƒ‰ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«ã€æ··åˆã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ(MoE)ã«ã‚ˆã‚‹ç–ãƒ¢ãƒ‡ãƒ«ã®æ‹¡å¼µã‚„ã€è¦–è¦šãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«VLM: [MiniMind-V](https://github.com/jingyaogong/minimind-v) ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚  
* ã“ã‚Œã¯å˜ã«ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ¢ãƒ‡ãƒ«ã‚’å®Ÿè£…ã—ãŸã ã‘ã§ãªãã€å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼ˆLLMï¼‰ã‚’å­¦ã¶ãŸã‚ã®å…¥é–€çš„ãªãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã—ã¾ã™ã€‚  
* æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãã£ã‹ã‘ã«ã€ç ”ç©¶è€…ã®æ–¹ã€…ãŒæ°—è»½ã«LLMã‚’è©¦ã—ã€ã•ã‚‰ãªã‚‹æ¢ç©¶ã¨é©æ–°ã‚’é€²ã‚ã¦ãã ã•ã‚‹ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ã€‚

  > èª¤è§£ã‚’é¿ã‘ã‚‹ãŸã‚ã«è£œè¶³ã™ã‚‹ã¨ã€ã€Œæœ€çŸ­3æ™‚é–“ã€ã¨ã„ã†ã®ã¯ã€æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œè€…ãŒä½¿ç”¨ã—ã¦ã„ã‚‹ãƒã‚·ãƒ³ã‚¹ãƒšãƒƒã‚¯ä»¥ä¸Šã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æ­è¼‰ã—ãŸç’°å¢ƒã§ã®æ¨å®šå€¤ã§ã™ã€‚è©³ç´°ãªã‚¹ãƒšãƒƒã‚¯ã¯å¾Œè¿°ã—ã¾ã™ã€‚

---

<div align="center">

![streamlit](./images/streamlit.gif)

[ModelScope ã§ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ä½“é¨“](https://www.modelscope.cn/studios/gongjy/minimind) | [Bilibili ãƒ“ãƒ‡ã‚ª](https://www.bilibili.com/video/BV12dHPeqE72/?share_source=copy_web&vd_source=670c2504f88726f8cf4a21ef6147c0e8)

---

</div>

## ğŸ“Œ ã¯ã˜ã‚ã«

GPTã€LLaMAã€GLMãªã©ã«ä»£è¡¨ã•ã‚Œã‚‹å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼ˆLLMï¼‰ã¯ã€é«˜ã„æ€§èƒ½ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€ãŸã¨ãˆã°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ãŒ100å„„ã‚’è¶…ãˆã‚‹ã‚ˆã†ãªãƒ¢ãƒ‡ãƒ«ã¯ã€å€‹äººã®GPUã§ã¯ãƒ¡ãƒ¢ãƒªä¸è¶³ã§å­¦ç¿’ã©ã“ã‚ã‹æ¨è«–ã™ã‚‰é›£ã—ã„ã“ã¨ãŒã—ã°ã—ã°ã‚ã‚Šã¾ã™ã€‚  
ã¾ãŸã€å˜ã«å¤§è¦æ¨¡ãƒ¢ãƒ‡ãƒ«ã‚’éƒ¨åˆ†çš„ã«LoRAã§ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¦ã€Œã„ãã¤ã‹ã®å‘½ä»¤ã‚’å­¦ç¿’ã•ã›ã‚‹ã€ã ã‘ã§ã¯ã€çœŸã®æ„å‘³ã§LLMã‚’ç†è§£ã—ãŸã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚ã“ã‚Œã¯ä¾‹ãˆã‚‹ãªã‚‰ã€ã€Œãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³ãŒã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’ä½¿ã„ã“ãªã™æ–¹æ³•ã€ã‚’æ•™ãˆã¦ã„ã‚‹ã‚ˆã†ãªã‚‚ã®ã§ã€è‚å¿ƒã®å­¦å•ã®é¢ç™½ã•ã‹ã‚‰é›¢ã‚Œã¦ã—ã¾ã„ãŒã¡ã§ã™ã€‚  
ã•ã‚‰ã«æ˜¨ä»Šã¯ã€æœ‰æ–™ã®è¬›åº§ã‚„ã‚µãƒ–ã‚¹ã‚¯ãªã©ã§ä¸­é€”åŠç«¯ãªçŸ¥è­˜ã‚’å…ƒã«ã—ãŸè§£èª¬ãŒæ°¾æ¿«ã—ã¦ã„ã¦ã€LLMã®æœ¬è³ªã‚’å­¦ã³ãŸã„äººã«ã¨ã£ã¦ã¯å­¦ç¿’ã®å¦¨ã’ã¨ãªã£ã¦ã„ã¾ã™ã€‚

ãã“ã§ã€æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®æ¨™ã¯ã€LLMã‚’æ‰±ã†ãƒãƒ¼ãƒ‰ãƒ«ã‚’å¾¹åº•çš„ã«ä¸‹ã’ã€ã€Œ0ã‹ã‚‰ç›´æ¥è»½é‡ã®ãƒ¢ãƒ‡ãƒ«ã‚’ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã™ã‚‹ã€ã‚„ã‚Šæ–¹ã‚’æç¤ºã™ã‚‹ã“ã¨ã«ã‚ã‚Šã¾ã™ã€‚

> [!TIP]
> ï¼ˆ2024å¹´9æœˆ17æ—¥æ™‚ç‚¹ï¼‰MiniMindã‚·ãƒªãƒ¼ã‚ºã¯ã€ã™ã§ã«3ç¨®é¡ã®ãƒ¢ãƒ‡ãƒ«ã‚’äº‹å‰å­¦ç¿’æ¸ˆã¿ã§ã€æœ€å°ãƒ¢ãƒ‡ãƒ«ï¼ˆ26M, 0.02Bï¼‰ãªãŒã‚‰ã€å¯¾è©±ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«ã§ãã‚‹èƒ½åŠ›ã‚’å‚™ãˆã¦ã„ã¾ã™ï¼

| ãƒ¢ãƒ‡ãƒ«ï¼ˆã‚µã‚¤ã‚ºï¼‰              | ãƒˆãƒ¼ã‚¯ãƒ³æ•° | æ¨è«–æ™‚ãƒ¡ãƒ¢ãƒª | ãƒªãƒªãƒ¼ã‚¹æ—¥      | ä¸»è¦³è©•ä¾¡ï¼ˆ/100ï¼‰ |
|-------------------------|-------------|--------|------------|------------|
| minimind-v1-small (26M) | 6400        | 0.5 GB | 2024.08.28 | 50'        |
| minimind-v1-moe (4Ã—26M) | 6400        | 1.0 GB | 2024.09.17 | 55'        |
| minimind-v1 (108M)      | 6400        | 1.0 GB | 2024.09.01 | 60'        |

> ã“ã‚Œã‚‰ã®æ•°å€¤ã¯Torch 2.1.2ã€CUDA 12.2ã€Flash Attention 2ã‚’ä½¿ç”¨ã—ã€RTX 3090ï¼ˆ24GBï¼‰ã‚’2æšæ­è¼‰ã—ãŸãƒã‚·ãƒ³ã§æ¤œè¨¼ã—ã¦ã„ã¾ã™ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ï¼š

- MiniMindã®ãƒ¢ãƒ‡ãƒ«ï¼ˆDenseãŠã‚ˆã³MoEæ§‹é€ ï¼‰ã€äº‹å‰å­¦ç¿’ï¼ˆPretrainï¼‰ã‹ã‚‰SFTã€LoRAã€DPOã«ã‚ˆã‚‹å¥½ã¿åˆã‚ã›ã¾ã§ã€ä¸€é€£ã®ã‚³ãƒ¼ãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ã™ã¹ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚  
- `transformers`ã€`accelerate`ã€`trl`ã€`peft` ãªã©ã®äººæ°—ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«å¯¾å¿œã€‚  
- ã‚·ãƒ³ã‚°ãƒ«GPU/ãƒãƒ«ãƒGPUï¼ˆDDPã€DeepSpeedï¼‰ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«å¯¾å¿œã—ã€`wandb` ã§å­¦ç¿’éç¨‹ã‚’å¯è¦–åŒ–å¯èƒ½ã€‚é€”ä¸­ã§ä¸€åº¦ä¸­æ–­ã—ã¦ã‚‚å¾Œã‹ã‚‰å†é–‹ã§ãã‚‹ã‚ˆã†è¨­è¨ˆã—ã¦ã„ã¾ã™ã€‚  
- Cevalãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½¿ã£ãŸç°¡å˜ãªãƒ¢ãƒ‡ãƒ«è©•ä¾¡ã‚³ãƒ¼ãƒ‰ã‚‚ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚  
- OpenAI APIé¢¨ã®ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ãŸã‚ã€ãŸã¨ãˆã° FastGPT ã‚„ Open-WebUI ãªã©ã®æ—¢å­˜UIã¨çµ±åˆã™ã‚‹ã“ã¨ãŒå®¹æ˜“ã§ã™ã€‚

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã€LLMåˆå¿ƒè€…ã®æ–¹ãŒæ—©æœŸã«å®Ÿè·µã§ãã‚‹ãŸã‚ã®è¶³ãŒã‹ã‚Šã¨ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

### ğŸ‘‰**æœ€è¿‘ã®æ›´æ–°æƒ…å ±**

<details close> 
<summary> <b>2024-10-05 (newest ğŸ‰)</b> </summary>

- MiniMindã«å¤šãƒ¢ãƒ¼ãƒ€ãƒ«æ‹¡å¼µï¼ˆè¦–è¦šï¼‰æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

- è©³ã—ãã¯å§‰å¦¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ [minimind-v](https://github.com/jingyaogong/minimind-v) ã‚’ã”è¦§ãã ã•ã„ï¼

</details>

<details close> 
<summary> <b>2024-09-27</b> </summary>

- äº‹å‰å­¦ç¿’ç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®å‰å‡¦ç†ã‚’è¦‹ç›´ã—ã€ãƒ†ã‚­ã‚¹ãƒˆã®å®Œå…¨æ€§ã‚’ä¿ã¤ãŸã‚ã« `.bin` å½¢å¼ã¯å»ƒæ­¢ã—ã¾ã—ãŸï¼ˆã‚ãšã‹ãªãŒã‚‰å­¦ç¿’é€Ÿåº¦ã¯ä½ä¸‹ï¼‰ã€‚  
- å‰å‡¦ç†å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«åã¯ `pretrain_data.csv` ã§ã™ã€‚  
- å†—é•·ãªã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—æ•´ç†ã—ã¾ã—ãŸã€‚

</details>

<details close> 
<summary> <b>2024-09-17</b> </summary>

- minimind-v1-moeãƒ¢ãƒ‡ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚  
- éå»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã®æ··ä¹±é˜²æ­¢ã¨ã‚µã‚¤ã‚ºç®¡ç†ã®ãŸã‚ã€`mistral_tokenizer` ã®ä½¿ç”¨ã‚’å»ƒæ­¢ã—ã€è‡ªä½œã® `minimind_tokenizer` ã«çµ±ä¸€ã—ã¾ã—ãŸã€‚

</details>

<details close>
<summary> <b>2024-09-01</b> </summary>

- minimind-v1 (108M)ãƒ¢ãƒ‡ãƒ«ã‚’æ›´æ–°ã€‚è‡ªä½œã® `minimind_tokenizer` ã‚’å°å…¥ã—ã€äº‹å‰å­¦ç¿’3ã‚¨ãƒãƒƒã‚¯ï¼‹SFT10ã‚¨ãƒãƒƒã‚¯ã§å­¦ç¿’ã‚’ã‚ˆã‚Šæ·±ã‚ã¦æ€§èƒ½å‘ä¸Šã€‚  
- ModelScopeï¼ˆé­”æ­ï¼‰ä¸Šã«ã‚‚å…¬é–‹ã—ã¦ã„ã‚‹ã®ã§ã€ã“ã¡ã‚‰ã§ã‚‚ãŠè©¦ã—ã„ãŸã ã‘ã¾ã™ï¼š

- [ğŸ”—ModelScopeã‚ªãƒ³ãƒ©ã‚¤ãƒ³ä½“é¨“ğŸ”—](https://www.modelscope.cn/studios/gongjy/minimind)

</details>

<details close> 
<summary> <b>2024-08-27</b> </summary>

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆã‚ã¦å…¬é–‹ã—ã¾ã—ãŸã€‚

</details>

## ğŸ“Œ ç’°å¢ƒæ§‹æˆ

ã“ã‚Œã¯ã‚ãã¾ã§ç­†è€…ã®ç’°å¢ƒã§ã™ã€‚å„è‡ªã®ç’°å¢ƒã«ã‚ˆã£ã¦èª¿æ•´ã—ã¦ãã ã•ã„ã€‚  

```bash
CPU: Intel(R) Core(TM) i9-10980XE CPU @ 3.00GHz
ãƒ¡ãƒ¢ãƒªï¼š128 GB
GPUï¼šNVIDIA GeForce RTX 3090ï¼ˆ24GBï¼‰Ã—2
ç’°å¢ƒï¼špython 3.9 + Torch 2.1.2 + DDPã«ã‚ˆã‚‹å˜æ©Ÿãƒãƒ«ãƒGPUå­¦ç¿’
```

* Ubuntu == 20.04
* Python == 3.9
* Pytorch == 2.1.2
* CUDA == 12.2
* [requirements.txt](./requirements.txt)

## ğŸ“Œ ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ (Quick Start Test)

<div align="center" style="font-size: 1.5em; font-weight: bold;">
  <img src="https://huggingface.co/front/assets/huggingface_logo-noborder.svg" alt="Hugging Face Logo" style="vertical-align: middle; height: 30px;" />
  Hugging Face

[MiniMind (HuggingFace)](https://huggingface.co/collections/jingyaogong/minimind-66caf8d999f5c7fa64f399e5)

 <img src="https://g.alicdn.com/sail-web/maas/1.15.0/static/modelscopeIcon.cd89353f.svg" alt="Hugging Face Logo" style="vertical-align: middle; height: 30px;" />

[MiniMind (ModelScope)](https://www.modelscope.cn/models/gongjy/minimind-v1)

</div>

```bash
# step 1
git clone https://huggingface.co/jingyaogong/minimind-v1
```

```bash
# step 2
python 2-eval.py
```

ã‚ã‚‹ã„ã¯ã€`streamlit` ã‚’ä½¿ã£ãŸç°¡æ˜“çš„ãªWebãƒãƒ£ãƒƒãƒˆUIã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ  
> ã€æ³¨æ„ã€‘Python>=3.10 ãŒå¿…è¦ã€‚`pip install streamlit==1.27.2` ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

```bash
# step 3 (åˆ¥ã®ã‚„ã‚Šæ–¹), streamlitã‚’å®Ÿè¡Œã™ã‚‹
streamlit run fast_inference.py
```

## ğŸ“Œ ã‚¯ã‚¤ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° (Quick Start Train)

###  0. ã¾ãšã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
    ```bash
    git clone https://github.com/jingyaogong/minimind.git
    cd minimind
    ```

###  1. ç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—


  ```bash
  pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
  ```

  ```python
  # torchã§CUDAãŒä½¿ãˆã‚‹ã‹ãƒ†ã‚¹ãƒˆ
  import torch
  print(torch.cuda.is_available())
  ```

  > ã‚‚ã—ä½¿ãˆãªã„ãªã‚‰ [torch_stable](https://download.pytorch.org/whl/torch_stable.html) ãªã©ã‹ã‚‰å¯¾å¿œã™ã‚‹whlã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ç’°å¢ƒã‚’æ•´ãˆã¦ãã ã•ã„ã€‚  


### 2. è‡ªåŠ›ã§å­¦ç¿’ã‚’è©¦ã—ãŸã„å ´åˆ

* 2.1 [ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯](#ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å…ˆ)ã‹ã‚‰å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¥æ‰‹ã—ã€`./dataset` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ã¾ã™ã€‚  

* 2.2 `python data_process.py` ã‚’å®Ÿè¡Œã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’å‰å‡¦ç†ã—ã¾ã™ã€‚
  ãŸã¨ãˆã°äº‹å‰å­¦ç¿’ï¼ˆPretrainï¼‰ãƒ‡ãƒ¼ã‚¿ã®ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã‚„ã€SFTç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‹ã‚‰Q&AæŠ½å‡ºãªã©ã‚’è¡Œã„ã¾ã™ã€‚  

* 2.3 `./model/LMConfig.py` ã§ãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šã‚’èª¿æ•´
  
  > ã“ã“ã§ã¯ä¸»ã«dimã¨n_layersã¨use_moeãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª¿æ•´ã—ã¾ã™ã€‚
  > ãã‚Œãã‚Œ `(512 + 8)` ã‚„ `(768 + 16)` ã«è¨­å®šã™ã‚‹ã¨ã€`minimind-v1-small` ã¨ `minimind-v1` ã«å¯¾å¿œã—ã¾ã™ã€‚
  
* 2.4 `python 1-pretrain.py` ã‚’å®Ÿè¡Œã—ã¦ã€äº‹å‰å­¦ç¿’ï¼ˆPretrainï¼‰ã‚’è¡Œã„ã¾ã™ã€‚
  å®Œäº†ã™ã‚‹ã¨é‡ã¿ `pretrain_*.pth` ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚  

* 2.5 `python 3-full_sft.py` ã‚’å®Ÿè¡Œã—ã¦ã€æ•™å¸«ã‚ã‚Šãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆSFTï¼‰ã‚’è¡Œã„ã¾ã™ã€‚
  å®Œäº†ã™ã‚‹ã¨é‡ã¿ `full_sft_*.pth` ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚  

* 2.6 å¿…è¦ã«å¿œã˜ã¦ `python 4-lora_sft.py` ã§ä½ãƒ©ãƒ³ã‚¯é©å¿œï¼ˆLoRAï¼‰æ‰‹æ³•ã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ï¼ˆä»»æ„ï¼‰ã€‚  

* 2.7 å¿…è¦ã«å¿œã˜ã¦ `python 5-dpo_train.py` ã§DPOï¼ˆDirect Preference Optimization, RLHFã®ä¸€ç¨®ï¼‰ã‚’è¡Œã„ã¾ã™ï¼ˆä»»æ„ï¼‰ã€‚  


### 3. ãƒ¢ãƒ‡ãƒ«ã®æ¨è«–åŠ¹æœã‚’ãƒ†ã‚¹ãƒˆ

- ä½¿ç”¨ã—ãŸã„å­¦ç¿’æ¸ˆã¿ã®é‡ã¿ `*.pth` ãƒ•ã‚¡ã‚¤ãƒ«ãŒ `./out/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚  

* ã‚ã‚‹ã„ã¯[å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«](#å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã®é‡ã¿)ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€è¨“ç·´æ¸ˆã¿ã®é‡ã¿ãƒ•ã‚¡ã‚¤ãƒ« `*.pth` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚
  ```text
  minimind/out
  â”œâ”€â”€ multi_chat
  â”‚Â Â  â”œâ”€â”€ full_sft_512.pth
  â”‚Â Â  â”œâ”€â”€ full_sft_512_moe.pth
  â”‚Â Â  â””â”€â”€ full_sft_768.pth
  â”œâ”€â”€ single_chat
  â”‚Â Â  â”œâ”€â”€ full_sft_512.pth
  â”‚Â Â  â”œâ”€â”€ full_sft_512_moe.pth
  â”‚Â Â  â””â”€â”€ full_sft_768.pth
  â”œâ”€â”€ pretrain_768.pth
  â”œâ”€â”€ pretrain_512_moe.pth
  â”œâ”€â”€ pretrain_512.pth
  ```
* `python 0-eval_pretrain.py` ã§äº‹å‰å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®é€£æƒ³ç”Ÿæˆï¼ˆæ¬¡ãƒˆãƒ¼ã‚¯ãƒ³äºˆæ¸¬ï¼‰ã‚’ç¢ºèªã—ã¾ã™ã€‚  
* `python 2-eval.py` ã§ãƒãƒ£ãƒƒãƒˆå½¢å¼ã®æ¨è«–ã‚’ç¢ºèªã—ã¾ã™ã€‚  
  ![2-eval](./images/2-eval.png)


ğŸ­ã€Œãƒ’ãƒ³ãƒˆã€ï¼šäº‹å‰å­¦ç¿’ï¼ˆ1-pretrain.pyï¼‰ã¨å…¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¾®èª¿æ•´ï¼ˆ3-full_sft.pyï¼‰ã¯ã€ã¨ã‚‚ã«ãƒãƒ«ãƒGPUã«ã‚ˆã‚‹åŠ é€Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã™

> ä¾‹ï¼šGPU1æšã—ã‹ãªã„å ´åˆã€æ™®é€šã«ä¸‹è¨˜ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§OKã§ã™ã€‚
```bash
python 1-pretrain.py
python 3-full_sft.py
```

> GPUãŒNæšã‚ã‚‹å ´åˆï¼ˆN>1ï¼‰ã¯ãƒãƒ«ãƒGPUã‚’ä½¿ã£ã¦é«˜é€ŸåŒ–ã§ãã¾ã™ã€‚

* 1ãƒã‚·ãƒ³ã®Næšã®ãƒãƒ«ãƒGPUç’°å¢ƒã§ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹(DDP: Distributed Data Parallel)
    
    ```bash
    torchrun --nproc_per_node N 1-pretrain.py
    torchrun --nproc_per_node N 3-full_sft.py
    ```
* 1ãƒã‚·ãƒ³ã®Næšã®ãƒãƒ«ãƒGPUç’°å¢ƒã§ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹(DeepSpeed)
    
    ```bash
    deepspeed --master_port 29500 --num_gpus=N 1-pretrain.py
    deepspeed --master_port 29500 --num_gpus=N 3-full_sft.py
    ```
* `wandb` ã‚’ä½¿ã£ã¦å­¦ç¿’ã‚’å¯è¦–åŒ–ã—ãŸã„å ´åˆï¼ˆå¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰
    
    ```bash
    torchrun --nproc_per_node N 1-pretrain.py --use_wandb
    # ã‚·ãƒ³ã‚°ãƒ«GPUãªã‚‰
    python 1-pretrain.py --use_wandb
  ```
  å¼•æ•° `--use_wandb` ã‚’æŒ‡å®šã™ã‚‹ã¨ WandB (Weights & Biases) ã«å­¦ç¿’ãƒ­ã‚°ã‚’è¨˜éŒ²å¯èƒ½ã€‚  
  `wandb_project` ã‚„ `wandb_run_name` ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåãƒ»å®Ÿè¡Œåã‚’æŒ‡å®šã§ãã¾ã™ã€‚

## ğŸ“Œ ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹

- ğŸ¤– **ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ï¼ˆTokenizerï¼‰**  
  NLPåˆ†é‡ã§ã¯ã€è‡ªç„¶è¨€èªã‚’å˜èªã‚ã‚‹ã„ã¯ã‚µãƒ–ãƒ¯ãƒ¼ãƒ‰å˜ä½ã«åˆ†å‰²ã—ã€å¯¾å¿œã™ã‚‹IDã«å¤‰æ›ã™ã‚‹ãŸã‚ã®ã€Œè¾æ›¸ã€ã‚’ä½œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼ˆLLMï¼‰ã«ãŠã„ã¦ã€å˜èªåŸ‹ã‚è¾¼ã¿ã‚„å‡ºåŠ›å±¤ã¨ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã¨ã—ã¦ã¨ã¦ã‚‚é‡è¦ã§ã™ã€‚  
  Tokenizerã®ä½œã‚Šæ–¹ã¯ä¸»ã«2é€šã‚Šã‚ã‚Šã€è‡ªåˆ†ã§å°ã•ãªèªå½™ãƒªã‚¹ãƒˆã‚’å­¦ç¿’ã•ã›ã‚‹ã‹ï¼ˆ`train_tokenizer.py` ã‚’å‚ç…§ï¼‰ã€ã™ã§ã«å…¬é–‹ã•ã‚Œã¦ã„ã‚‹Tokenizerã‚’æ‹å€Ÿã™ã‚‹ã‹ã®ã„ãšã‚Œã‹ã§ã™ã€‚  
  èªå½™æ•°ãŒã‚ã¾ã‚Šã«å¤§ãã„ã¨Embeddingã ã‘ã§ã‚‚è†¨å¤§ã«ãªã‚Šå°å‹ãƒ¢ãƒ‡ãƒ«ã‚’åœ§è¿«ã™ã‚‹ãŸã‚ã€MiniMindã§ã¯è‡ªä½œTokenizerã‚’ç”¨ã„ã¦6400ã¨ã„ã†ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªèªå½™æ•°ã«æŠ‘ãˆã¦ã„ã¾ã™ã€‚  
  ä¸€éƒ¨ã®è‘—åãƒ¢ãƒ‡ãƒ«ã§ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªèªå½™æ•°ã‚’æŒã¡ã¾ã™ï¼š

  <table>
    <tr><th>Tokenizerãƒ¢ãƒ‡ãƒ«</th><th>èªå½™ã‚µã‚¤ã‚º</th><th>é–‹ç™ºå…ƒ</th></tr>
    <tr><td>yi tokenizer</td><td>64,000</td><td>01-aiï¼ˆä¸­å›½ï¼‰</td></tr>
    <tr><td>qwen2 tokenizer</td><td>151,643</td><td>ã‚¢ãƒªãƒãƒã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆä¸­å›½ï¼‰</td></tr>
    <tr><td>glm tokenizer</td><td>151,329</td><td>æ™ºè°±AIï¼ˆä¸­å›½ï¼‰</td></tr>
    <tr><td>mistral tokenizer</td><td>32,000</td><td>Mistral AIï¼ˆãƒ•ãƒ©ãƒ³ã‚¹ï¼‰</td></tr>
    <tr><td>llama3 tokenizer</td><td>128,000</td><td>Metaï¼ˆã‚¢ãƒ¡ãƒªã‚«ï¼‰</td></tr>
    <tr><td>minimind tokenizer</td><td>6,400</td><td>ã‚«ã‚¹ã‚¿ãƒ </td></tr>
  </table>

  
  > 2024å¹´9æœˆ17æ—¥ä»¥é™ã€ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚ºã‚’å°ã•ãä¿ã¡ã¤ã¤æ··ä¹±ã‚’é¿ã‘ã‚‹ãŸã‚ã€`minimind_tokenizer` ã«å®Œå…¨çµ±ä¸€ã—ã¾ã—ãŸï¼ˆ`mistral_tokenizer`ã¯å»ƒæ­¢ï¼‰ã€‚  
  > minimind_tokenizerã®é•·ã•ã¯éå¸¸ã«å°ã•ãã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‡ã‚³ãƒ¼ãƒ‰åŠ¹ç‡ã¯qwen2ã‚„glmãªã©ã®ä¸­å›½èªã«é©ã—ãŸãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã‚ˆã‚Šã‚‚åŠ£ã‚Šã¾ã™ã€‚ ã—ã‹ã—ã€minimindãƒ¢ãƒ‡ãƒ«ã¯ç‹¬è‡ªã«è¨“ç·´ã—ãŸã€èªå½™ã‚µã‚¤ã‚ºãŒ6400ã—ã‹ãªã„`minimind_tokenizer`ã‚’ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã¨ã—ã¦é¸æŠã™ã‚‹ã“ã¨ã§ã€å…¨ä½“çš„ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è»½é‡æ€§ã‚’ä¿ã¡ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å±¤ã¨è¨ˆç®—å±¤ã®æ¯”ç‡ã®ä¸å‡è¡¡ã«ã‚ˆã‚Šé ­ã§ã£ã‹ã¡ã«ãªã‚‹ã®ã‚’å›é¿ã—ã¦ã„ã¾ã™ã€‚
  >  ã¾ãŸã€minimindã¯å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆã§çã—ã„å˜èªã®ãƒ‡ã‚³ãƒ¼ãƒ‰ã«å¤±æ•—ã™ã‚‹ã‚±ãƒ¼ã‚¹ã¯ç™ºç”Ÿã—ã¦ãŠã‚‰ãšã€è‰¯å¥½ãªåŠ¹æœã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ ã‚«ã‚¹ã‚¿ãƒ èªå½™è¡¨ã‚’6400ã¾ã§åœ§ç¸®ã™ã‚‹ã“ã¨ã§ã€LLMã®ç·ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ã‚’æœ€å°ã§26Mã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

---

- ğŸ“™ **Pretrainãƒ‡ãƒ¼ã‚¿**  
  [Seq-Monkeyé€šç”¨ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ](https://github.com/mobvoi/seq-monkey-data/blob/main/docs/pretrain_open_corpus.md) / [Baidu Netdisk](https://pan.baidu.com/s/114F1k3eksiWCOQLvaT3RYQ?pwd=6666)  
  å¤šæ•°ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã€ç™¾ç§‘äº‹å…¸ã€ãƒ–ãƒ­ã‚°ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã€æ›¸ç±ãªã©ã€å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬åé›†ãƒ»ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°ã—ãŸå¤§è¦æ¨¡ã‚³ãƒ¼ãƒ‘ã‚¹ã§ã™ã€‚é‡è¤‡é™¤å»ã‚„è³ªã®ç²¾æŸ»ãŒè¡Œã‚ã‚Œã¦ãŠã‚Šã€ç·é‡ã¯ç´„100å„„ãƒˆãƒ¼ã‚¯ãƒ³ã€‚ä¸­æ–‡ï¼ˆä¸­å›½èªï¼‰ä¸»ä½“ã§ã™ãŒã€LLMã®äº‹å‰å­¦ç¿’ã«ç”¨ã„ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚  

  > ä»£æ›¿ã¨ã—ã¦ [SkyPile-150B](https://hf-mirror.com/datasets/Skywork/SkyPile-150B/tree/main/data) ã‚‚ã‚ã‚Šã€ãã¡ã‚‰ã¯ç´„2.33å„„ã®ç‹¬ç«‹ã—ãŸã‚¦ã‚§ãƒ–ã‚’å«ã¿åˆè¨ˆ1500å„„ãƒˆãƒ¼ã‚¯ãƒ³ã€ç´„620GBã®ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã€‚  
  **ãŠè©¦ã—ãªã‚‰** SkyPile-150Bã‹ã‚‰ä¸€éƒ¨åˆ†ã ã‘å–å¾—ã—ã€`data_process.py` ã§ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚ºï¼† .csvåŒ–ã™ã‚‹æ‰‹ã‚‚ã‚ã‚Šã¾ã™ã€‚

---

- ğŸ“• **SFTãƒ‡ãƒ¼ã‚¿**  
  [åŒ æ•°å¤§æ¨¡å‹SFTãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ](https://www.modelscope.cn/datasets/deepctrl/deepctrl-sft-data) ã§ã¯ã€å¤§é‡ã®å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã‚’é›†ç´„ã—ã€å®‰å…¨æ€§ã‚„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãã‚ãˆãŸå½¢ã§æä¾›ã—ã¦ã„ã¾ã™ã€‚  
  ä¸­å›½èªã§ç´„1000ä¸‡ä»¶ã€è‹±èªã§ç´„200ä¸‡ä»¶ã€è¨ˆ30å„„ãƒˆãƒ¼ã‚¯ãƒ³è¦æ¨¡ã®å‘½ä»¤ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã€LLMã®ã€Œæ•™å¸«ã‚ã‚Šå¾®èª¿æ•´ï¼ˆSFTï¼‰ã€ã«é©ã—ãŸå†…å®¹ã§ã™ã€‚  
  å…ƒã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆã—ã¦ã„ã‚‹ãŸã‚ã€**ã€SFTãƒ‡ãƒ¼ã‚¿ã€‘**ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚Œã°ä¸€å¼ãã‚ã„ã¾ã™ï¼š

    - [BelleGroup/train_3.5M_CN](https://huggingface.co/datasets/BelleGroup/train_3.5M_CN)
    - [LinkSoul/instruction_merge_set](https://huggingface.co/datasets/LinkSoul/instruction_merge_set)
    - [stingning/ultrachat](https://huggingface.co/datasets/stingning/ultrachat)
    - [BAAI/COIG-PC-core](https://huggingface.co/datasets/BAAI/COIG-PC-core)
    - [shibing624/sharegpt_gpt4](https://huggingface.co/datasets/shibing624/sharegpt_gpt4)
    - [shareAI/ShareGPT-Chinese-English-90k](https://huggingface.co/datasets/shareAI/ShareGPT-Chinese-English-90k)
    - [TigerResearch/sft_zh](https://huggingface.co/datasets/TigerResearch/sft_zh)
    - [BelleGroup/school_math_0.25M](https://huggingface.co/datasets/BelleGroup/school_math_0.25M)
    - [YeungNLP/moss-003-sft-data](https://huggingface.co/datasets/YeungNLP/moss-003-sft-data)

---

- ğŸ“˜ **DPOãƒ‡ãƒ¼ã‚¿**  
  [æ´»å­—æ¨¡å‹](https://github.com/HIT-SCIR/huozi) ãªã©ã‹ã‚‰é›†ã‚ã‚‰ã‚ŒãŸã€å¥½ã¿ã«é–¢ã™ã‚‹äººé–“ã®ãƒ©ãƒ™ãƒ«ã‚’ä»˜ä¸ã—ãŸãƒ‡ãƒ¼ã‚¿ç´„8ä¸‡ä»¶ã§ã™ã€‚ã“ã‚Œã‚’ä½¿ã£ã¦ã€å ±é…¬ãƒ¢ãƒ‡ãƒ«ãªã—ã§DPOï¼ˆDirect Preference Optimizationï¼‰ã«ã‚ˆã‚‹å¥½ã¿åˆã‚ã›ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚  

---

- **ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ**  
  [HqWu-HITCS/Awesome-Chinese-LLM](https://github.com/HqWu-HITCS/Awesome-Chinese-LLM) ã«ã¯ã€ä¸­å›½èªLLMã«é–¢ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã€ã‚¢ãƒ—ãƒªã€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãªã©ãŒåŒ…æ‹¬çš„ã«ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚éšæ™‚æ›´æ–°ã•ã‚Œã¦ãŠã‚Šã€å¤§å¤‰å‚è€ƒã«ãªã‚Šã¾ã™ã€‚

---

### ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å…ˆ

`./dataset/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç½®ã„ã¦ãã ã•ã„

| MiniMind è®­ç»ƒç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ  | ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å…ˆ                                                                                                                                                                                                |
|-----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ã€tokenizerå­¦ç¿’ç”¨ã€‘**       | [HuggingFace](https://huggingface.co/datasets/jingyaogong/minimind_dataset/tree/main) / [ç™¾åº¦ç½‘ç›˜](https://pan.baidu.com/s/1yAw1LVTftuhQGAC1Y9RdYQ?pwd=6666)                                                                                     |
| **ã€Pretrainãƒ‡ãƒ¼ã‚¿ã€‘**      | [Seq-Monkeyå…¬å¼](http://share.mobvoi.com:5000/sharing/O91blwPkY) / [ç™¾åº¦ç½‘ç›˜](https://pan.baidu.com/s/1-Z8Q37lJD4tOKhyBs1D_6Q?pwd=6666) / [HuggingFace](https://huggingface.co/datasets/jingyaogong/minimind_dataset/tree/main)                |
| **ã€SFTãƒ‡ãƒ¼ã‚¿ã€‘**           | [åŒ æ•°å¤§æ¨¡å‹SFTãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ](https://www.modelscope.cn/datasets/deepctrl/deepctrl-sft-data/resolve/master/sft_data_zh.jsonl)                                                                                         |
| **ã€DPOãƒ‡ãƒ¼ã‚¿ã€‘**           | [HuggingFace](https://huggingface.co/datasets/jingyaogong/minimind_dataset/tree/main/dpo)                                                                                                                  |

# ğŸ“Œ ãƒ¢ãƒ‡ãƒ«æ§‹é€ 

MiniMind-Denseã¯ï¼ˆ[Llama3.1](https://ai.meta.com/blog/meta-llama-3-1/)ã¨åŒæ§˜ã«ï¼‰Decoder-OnlyãªTransformerã§ã€GPT-3ã¨ã®ä¸»ãªé•ã„ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

* GPT-3ã§æ¡ç”¨ã•ã‚ŒãŸã€Œå‰æ®µã®æ­£è¦åŒ–ã€ï¼ˆPre-LNï¼‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å°å…¥ã€‚å…·ä½“çš„ã«ã¯RMSNormã‚’å„ã‚µãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥å£ã§å®Ÿè¡Œã—ã¾ã™ã€‚  
* æ´»æ€§åŒ–é–¢æ•°ã«SwiGLUã‚’æ¡ç”¨ï¼ˆReLUã§ã¯ãªãï¼‰ã—ã€æ€§èƒ½å‘ä¸Šã‚’å›³ã£ã¦ã„ã¾ã™ã€‚  
* GPT-Neoã®ã‚ˆã†ã«çµ¶å¯¾ä½ç½®Embeddingã‚’æ’ã—ã€ä»£ã‚ã‚Šã«RoPEï¼ˆå›è»¢ä½ç½®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼‰ã‚’å°å…¥ã€‚å­¦ç¿’ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’è¶…ãˆã‚‹æ¨è«–æ™‚ã§ã‚‚ã‚ã‚‹ç¨‹åº¦å¯¾å¿œã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

---

MiniMind-MoEã¯ã€Llama3ã‚„[Deepseek-V2](https://arxiv.org/pdf/2405.04434)ã®MixFFNã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸæ··åˆã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆæ§‹é€ ï¼ˆMoEï¼‰ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

* DeepSeek-V2ã§ææ¡ˆã•ã‚ŒãŸã€å‰å‘ããƒ•ã‚£ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ï¼ˆFFNï¼‰ã®å°‚é–€åˆ†å‰²ã¨å…±æœ‰åˆ†å‰²ã‚’å·§ã¿ã«çµ„ã¿åˆã‚ã›ã‚‹æ‰‹æ³•ã‚’ä¸€éƒ¨å‚è€ƒã«ã—ã€ãã‚Œãã‚Œã®â€œExpertâ€ã‚’åŠ¹ç‡çš„ã«æ´»æ€§åŒ–ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

---

RoPEã®è¨ˆç®—ã‚„æ¨è«–é–¢æ•°ã€FFNéƒ¨åˆ†ã®ã‚³ãƒ¼ãƒ‰ãŒè‹¥å¹²ç•°ãªã‚‹ã ã‘ã§ã€å…¨ä½“æ§‹é€ ã¯å…±é€šã§ã™ã€‚å†æç”»ã—ãŸå›³ã‚’ç¤ºã™ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

![](./images/LLM-structure.png)
![](./images/LLM-structure-moe.png)

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ [./model/LMConfig.py](./model/LMConfig.py) ã§ã™ã€‚ç¾æ™‚ç‚¹ã§å­¦ç¿’æ¸ˆã¿ã®MiniMindãƒ¢ãƒ‡ãƒ«ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ï¼š

| Model Name        | params | len_vocab | n_layers | d_model | kv_heads | q_heads | share+route | TopK |
|-------------------|--------|-----------|----------|---------|----------|---------|-------------|------|
| minimind-v1-small | 26M    | 6400      | 8        | 512     | 8        | 16      | -           | -    |
| minimind-v1-moe   | 4Ã—26M  | 6400      | 8        | 512     | 8        | 16      | 2+4         | 2    |
| minimind-v1       | 108M   | 6400      | 16       | 768     | 8        | 16      | -           | -    |

# ğŸ“Œ å®Ÿé¨“çµæœ

| Model Name        | params | len_vocab | batch_size | pretrain_time     | sft_single_time   | sft_multi_time      |
|-------------------|--------|-----------|------------|-------------------|-------------------|---------------------|
| minimind-v1-small | 26M    | 6400      | 64         | â‰ˆ2 hour (1 epoch) | â‰ˆ2 hour (1 epoch) | â‰ˆ0.5 hour (1 epoch) |
| minimind-v1-moe   | 4Ã—26M  | 6400      | 40         | â‰ˆ6 hour (1 epoch) | â‰ˆ5 hour (1 epoch) | â‰ˆ1 hour (1 epoch)   |
| minimind-v1       | 108M   | 6400      | 16         | â‰ˆ6 hour (1 epoch) | â‰ˆ4 hour (1 epoch) | â‰ˆ1 hour (1 epoch)   |

---

1. **äº‹å‰å­¦ç¿’ï¼ˆText-to-Textï¼‰**  
   - ã¾ãšå¤§é‡ã®ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ¼ãƒ‘ã‚¹ã‚’ç”¨ã„ã¦ã€ç„¡ç›£ç£ã®æ¬¡ãƒˆãƒ¼ã‚¯ãƒ³äºˆæ¸¬ï¼ˆã€Œå˜èªã®é€£æƒ³ã‚²ãƒ¼ãƒ ã€ï¼‰ã‚’å­¦ç¿’ã—ã€åŸºç¤çŸ¥è­˜ã‚’ãƒ¢ãƒ‡ãƒ«å†…éƒ¨ã«å–ã‚Šè¾¼ã¿ã¾ã™ã€‚  
   - ä¾‹ï¼šã€Œç§¦å§‹çš‡ã¯ã€ã®ã‚ã¨ã«ã€Œä¸­å›½ã®åˆä»£çš‡å¸ã€ã¨ã„ã†å˜èªåˆ—ã‚’é«˜ç¢ºç‡ã§å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€ã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚  
   > å­¦ç¿’ç‡ã¯1e-4ï½1e-5ã€ã‚¨ãƒãƒƒã‚¯ã¯5ç¨‹åº¦ã€‚

    ```bash
    torchrun --nproc_per_node 2 1-pretrain.py
    ```

2. **æ•™å¸«ã‚ã‚Šå¾®èª¿æ•´ï¼ˆSFTï¼‰â€• å˜ä¸€ã‚¿ãƒ¼ãƒ³ä¼šè©±**  
   - äº‹å‰å­¦ç¿’æ®µéšã§ã¯ã€Œè¨€èªçŸ¥è­˜ã€ãŒèº«ã«ã¤ãã¾ã—ãŸãŒã€ãã‚Œã‚’ãƒãƒ£ãƒƒãƒˆã¨ã—ã¦æ´»ã‹ã™ãŸã‚ã«ã¯ä¼šè©±å½¢å¼ã‚’å­¦ç¿’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
   - SFTã‚’å®Ÿè¡Œã—ã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã¨ã€ãã®å›ç­”ã€ã¨ã„ã†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ•™ãˆè¾¼ã‚€ã“ã¨ã§ã€ã€Œã“ã“ã‹ã‚‰å…ˆãŒå›ç­”ã€ã€Œã“ã“ã¾ã§ãŒè³ªå•ã€ã®ã‚ˆã†ãªå¯¾è©±ã®å‹ã‚’èº«ã«ã¤ã‘ã•ã›ã¾ã™ã€‚  
   - å®Ÿè£…ã®éƒ½åˆä¸Šã€ãƒˆãƒ¼ã‚¯ãƒ³é•·ã¯512ã«åˆ‡ã‚Šè©°ã‚ã¦ã„ã¾ã™ãŒã€æ¨è«–æ™‚ã«ã¯RoPEè£œæ­£ã‚’ä½¿ã†ã“ã¨ã§ã€ã‚ˆã‚Šé•·ã„ãƒ†ã‚­ã‚¹ãƒˆã‚‚æ‰±ãˆã¾ã™ã€‚  
   > å­¦ç¿’ç‡1e-5â†’1e-6ã«Cosineæ¸›è¡°ã€ã‚¨ãƒãƒƒã‚¯6ç¨‹åº¦ã€‚

   ```bash
   # 3-full_sft.py å†…ã§ sft_data_single.csv ã‚’ä½¿ç”¨
   torchrun --nproc_per_node 2 3-full_sft.py
   ```

3. **å¤šè¼ªï¼ˆãƒãƒ«ãƒã‚¿ãƒ¼ãƒ³ï¼‰ä¼šè©±ã®SFT**  
   - å˜ä¸€ã‚¿ãƒ¼ãƒ³ï¼ˆQâ†’Aï¼‰ã‚’ç¿’å¾—ã—ãŸãƒ¢ãƒ‡ãƒ«ã‚’ã•ã‚‰ã«å¼·åŒ–ã—ã€éå»ã®Q&Aã‚‚è€ƒæ…®ã«å…¥ã‚ŒãŸä¼šè©±ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’ã•ã›ã¾ã™ã€‚  
   - å…·ä½“çš„ã«ã¯ history_chat ã‚„ history_chat_response ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã„ã€Q1â†’A1ã€Q2â†’A2â€¦ã¨ã„ã£ãŸé€£ç¶šçš„ãªæµã‚Œã«ã‚‚å¯¾å¿œã•ã›ã¾ã™ã€‚  
   - å°å‹ãƒ¢ãƒ‡ãƒ«ã¯é•·ã„æ–‡è„ˆä¿æŒãŒè‹¦æ‰‹ã§ã‚ã‚Šã€å­¦ç¿’ã•ã›éãã‚‹ã¨é€†ã«å˜ä¸€ã‚¿ãƒ¼ãƒ³å›ç­”ã®ç²¾åº¦ãŒä¸‹ãŒã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚  
   > å­¦ç¿’ç‡1e-5â†’1e-6ã€ã‚¨ãƒãƒƒã‚¯5ç¨‹åº¦ã€‚

    ```bash
    # 3-full_sft.py å†…ã§ sft_data.csv ã‚’ä½¿ç”¨
    torchrun --nproc_per_node 2 3-full_sft.py
    ```

4. **äººé–“ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«ã‚ˆã‚‹å¼·åŒ–å­¦ç¿’ï¼ˆRLHFï¼‰â€• DPO**  
   - å¾“æ¥ã®PPOï¼ˆProximal Policy Optimizationï¼‰ãªã©ã¨ã¯ç•°ãªã‚Šã€DPOï¼ˆDirect Preference Optimizationï¼‰ã¯é›¢ç·šãƒ‡ãƒ¼ã‚¿ä¸­ã®ã€Œè‰¯ã„å›ç­”ï¼æ‚ªã„å›ç­”ã€ã‚’æ¯”è¼ƒå­¦ç¿’ã—ã€äººé–“ã®å¥½ã¿ã«åˆã£ãŸå‡ºåŠ›ã‚’ç”Ÿæˆã—ã‚„ã™ãã—ã¾ã™ã€‚  
   - å ±é…¬ãƒ¢ãƒ‡ãƒ«ã‚’åˆ¥é€”å­¦ç¿’ã—ãªãã¦ã‚‚ã€DPOã®ç†è«–ã«ã‚ˆã‚Šè¿‘ä¼¼çš„ã«å¥½ã¿åˆã‚ã›ãŒã§ãã¾ã™ã€‚  
   - RLHFã¯ä¸‡èƒ½ã§ã¯ãªãã€å ´åˆã«ã‚ˆã£ã¦ã¯å†—é•·ãªè¡¨ç¾ãŒå¢—ãˆãŸã‚Šæƒ…å ±ç²¾åº¦ãŒã‚ãšã‹ã«ä½ä¸‹ã—ãŸã‚Šã‚‚ã—ã¾ã™ã€‚  
   > ç´„8ä¸‡ä»¶ã®ä¸‰ã¤çµ„(q, chosen, reject)ã‚’ä½¿ã„ã€å­¦ç¿’ç‡1e-5ã€fp16ã§1ï½2ã‚¨ãƒãƒƒã‚¯ç¨‹åº¦ã€‚  

    ```bash
    python 5-dpo_train.py
    ```

---

### GPT-3ã¨ã®æ¯”è¼ƒ

ãƒ¢ãƒ‡ãƒ«æ§‹é€ ã«ã¤ã„ã¦ã¯ã€GPT-3ã®ä¸‹è¨˜è¡¨ã‚’å‚è€ƒã«ã™ã‚‹ã¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®ç›®å®‰ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

![gpt3_config.png](./images/gpt3_config.png)

---

### å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã®é‡ã¿

[ğŸ”—Baidu Netdisk](https://pan.baidu.com/s/1KUfSzEkSXYbCCBj0Pw-9fA?pwd=6666)

| Model Name         | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | Config                      | pretrain_model         | single_sft_model                     | multi_sft_model                     | rl_model      |
|--------------------|-----------|-----------------------------|------------------------|--------------------------------------|-------------------------------------|---------------|
| minimind-v1-small  | 26M       | d_model=512<br/>n_layers=8  | `pretrain_512.pth`     | `single_chat/full_sft_512.pth`       | `multi_chat/full_sft_512.pth`       | `rl_512.pth`  |
| minimind-v1-moe    | 4Ã—26M     | d_model=512<br/>n_layers=8  | `pretrain_512_moe.pth` | `single_chat/full_sft_512_moe.pth`   | `multi_chat/full_sft_512_moe.pth`   | -             |
| minimind-v1        | 108M      | d_model=768<br/>n_layers=16 | `pretrain_768.pth`     | `single_chat/full_sft_768.pth`       | `multi_chat/full_sft_768.pth`       | `rl_768.pth`  |

---

# ğŸ“Œ è©•ä¾¡ï¼ˆEvalï¼‰

## â‘  RLHFã«é–¢ã™ã‚‹æ¯”è¼ƒ

> ä»¥ä¸‹ã¯ã€å˜ä¸€ã‚¿ãƒ¼ãƒ³SFTãƒ¢ãƒ‡ãƒ«ï¼ˆfull_sftï¼‰ã¨ã€DPOã«ã‚ˆã‚‹å¥½ã¿èª¿æ•´ã‚’ã—ãŸãƒ¢ãƒ‡ãƒ«ï¼ˆrlï¼‰ã‚’æ¯”è¼ƒã—ãŸä¾‹ã§ã™ã€‚  
> `rl_<dim>.pth` ãŒDPOã§å¥½ã¿åˆã‚ã›ã‚’å­¦ç¿’ã—ãŸãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚

ï¼ˆã‚µãƒ³ãƒ—ãƒ«ç•¥ï¼‰

### ğŸ‘‰ã¾ã¨ã‚
- RLHFï¼ˆDPOï¼‰ã‚’é©ç”¨ã™ã‚‹ã¨ã€ãƒ¢ãƒ‡ãƒ«ã¯ã‚ˆã‚Šä¸å¯§ãªè¡¨ç¾ã‚’ä½¿ã†å‚¾å‘ãŒé«˜ã¾ã‚Šã€å›ç­”ãŒå°‘ã—é•·ããªã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚  
- ä¸€æ–¹ã§ã€æƒ…å ±ã®ç°¡æ½”ã•ã‚„æ­£ç¢ºæ€§ãŒã‚ãšã‹ã«æãªã‚ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã‚‚è¦‹å—ã‘ã‚‰ã‚Œã¾ã™ã€‚  
- ã“ã‚Œã¯PPOã‚„ä»–ã®RLHFã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã‚‚ã‚ˆãã‚ã‚‹ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã§ã€å¿…ãšã—ã‚‚æ€§èƒ½ãŒä¸€è²«ã—ã¦ä¸Šæ˜‡ã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

## â‘¡ Instruct Fine-Tuning ã«ã¤ã„ã¦

> 2024å¹´9æœˆ17æ—¥æ™‚ç‚¹ã§ã®ãƒ†ã‚¹ãƒˆä¾‹ã§ã™ã€‚å˜ä¸€ã‚¿ãƒ¼ãƒ³SFTã®ã¿é©ç”¨ã—ã€å¤šè¼ªä¼šè©±ã‚„RLHFã¯å®Ÿæ–½ã—ã¦ã„ãªã„çŠ¶æ…‹ã€‚

[A] minimind-v1-small(0.02B)  
[B] minimind-v1-moe(0.1B)  
[C] minimind-v1(0.1B)  
[D] baby-llama2-chinese(0.2B)  
[E] chatlm-mini-chinese(0.2B)  

ã‚µãƒ³ãƒ—ãƒ«Q&Aã‚’æ¯”è¼ƒã™ã‚‹ã¨ã€CãŒæœ€ã‚‚å®‰å®šã—ã¦ã„ã¦ã€Aã¯ã‚µã‚¤ã‚ºãªã‚Šã«å¤šå°‘ã®èª¤ã‚ŠãŒã‚ã‚Šã€Bã‚‚é€”ä¸­ã®è¨ˆç®—ã‚„å€¤ã«èª¤ã‚ŠãŒæ•£è¦‹ã•ã‚Œã¾ã—ãŸã€‚Eã¯è©³ç´°ã ãŒå†—é•·ã€Dã¯å›ç­”ãŒçš„å¤–ã‚Œã«ãªã‚‹ä¾‹ã‚‚ã‚ã£ãŸã€ã¨ã„ã†å°è±¡ã§ã™ã€‚

> ã“ã‚Œã‚‰ã®å›ç­”ã‚’GPT-4ãªã©ã«è©•ä¾¡ã•ã›ãŸçµæœã€æ¦‚ã­ C > E > B > A > D ã¨ã„ã†é †åºã§ã—ãŸã€‚

---

## â‘¢ C-Evalãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã®å®¢è¦³è©•ä¾¡

[eval_ceval.py](./eval_ceval.py) ã§C-Evalã‚’è©•ä¾¡ã—ã¦ã„ã¾ã™ã€‚  
å°å‹ãƒ¢ãƒ‡ãƒ«ã§ã¯å¤šè‚¢é¸æŠå¼ã«ç‰¹åŒ–ã—ãŸèª¿æ•´ã‚’è¡Œã£ã¦ã„ãªã„ãŸã‚ã€å˜ç´”ã«é¸æŠè‚¢A/B/C/Dã®å‡ºåŠ›ç¢ºç‡ã‚’æ¯”ã¹ã€ä¸€ç•ªé«˜ã„ã‚‚ã®ãŒãƒ¢ãƒ‡ãƒ«ã®å›ç­”ã¨ã¿ãªã—ã¦æ­£ç­”ç‡ã‚’è¨ˆæ¸¬ã—ã¦ã„ã¾ã™ã€‚  
çµæœã¯ã‚ãã¾ã§å‚è€ƒç¨‹åº¦ã§ã™ã€‚

```text
minimind-v1-small
åˆè¨ˆå•é¡Œæ•°: 1346  
æ­£ç­”æ•°: 316  
æ­£ç­”ç‡: 23.48%
```

| ãƒ¢ãƒ‡ãƒ«              | æ­£ç­”æ•° | å…¨ä½“æ•° | æ­£ç­”ç‡  |
|--------------------|--------|-------|--------|
| minimind-v1-small  | 344    | 1346  | 25.56% |
| minimind-v1        | 351    | 1346  | 26.08% |

ã€Œå¾—æ„åˆ†é‡ï¼è‹¦æ‰‹åˆ†é‡ã€ãªã©è©³ã—ã„åˆ†æã¯çœç•¥ã—ã¾ã™ãŒã€æ³•å¾‹ã€ç‰©ç†ã€æ”¿æ²»ã€åœ°ç†ãªã©äººæ–‡ç¤¾ä¼šç³»ã®å°‚é–€åˆ†é‡ã¯ä½ã‚ã®æ­£ç­”ç‡ã§ã—ãŸã€‚  
åŒ–å­¦ã€é›¢æ•£æ•°å­¦ãªã©ç†ç³»ç§‘ç›®ã®ä¸€éƒ¨ã§ã¯ã‚„ã‚„é«˜ã‚ã§ã—ãŸã€‚

# ğŸ“Œ ãã®ä»–

### æ¨è«–ï¼†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

* [export_model.py](./export_model.py) ã‚’ä½¿ã†ã¨ã€transformersäº’æ›ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ãƒ¢ãƒ‡ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã€HuggingFaceã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚  

* MiniMindã®HuggingFaceã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼š  
  [MiniMind](https://huggingface.co/collections/jingyaogong/minimind-66caf8d999f5c7fa64f399e5)

---

### APIã«ã‚ˆã‚‹æ¨è«–

* [my_openai_api.py](./my_openai_api.py) ã¯ã€OpenAIäº’æ›ã®ãƒãƒ£ãƒƒãƒˆAPIã‚’èµ·å‹•ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚  
  ã“ã‚Œã«ã‚ˆã‚Šã€FastGPTã‚„Open-WebUIã¨ã„ã£ãŸå¤–éƒ¨UIã«çµ„ã¿è¾¼ã¿ã‚„ã™ããªã‚Šã¾ã™ã€‚  
* HuggingFaceã‹ã‚‰ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«é…ç½®ã—ã¦ãã ã•ã„ï¼š

    ```
    minimind (root dir)
    â”œâ”€minimind
    |  â”œâ”€â”€ config.json
    |  â”œâ”€â”€ generation_config.json
    |  â”œâ”€â”€ LMConfig.py
    |  â”œâ”€â”€ model.py
    |  â”œâ”€â”€ pytorch_model.bin
    |  â”œâ”€â”€ special_tokens_map.json
    |  â”œâ”€â”€ tokenizer_config.json
    |  â”œâ”€â”€ tokenizer.json
    ```

* ãƒãƒ£ãƒƒãƒˆã‚µãƒ¼ãƒã‚’èµ·å‹•
    ```bash
    python my_openai_api.py
    ```
* ã‚µãƒ³ãƒ—ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ  
    ```bash
    python chat_openai_api.py
    ```
* OpenAIäº’æ›ã®APIä¾‹ï¼š

    ```bash
    curl http://ip:port/v1/chat/completions \
      -H "Content-Type: application/json" \
      -d '{ 
        "model": "model-identifier",
        "messages": [ 
          { "role": "user", "content": "ä¸–ç•Œã§ä¸€ç•ªé«˜ã„å±±ã¯ã©ã“ã§ã™ã‹ï¼Ÿ" }
        ], 
        "temperature": 0.7, 
        "max_tokens": -1,
        "stream": true
    }'
    ```
![images](./images/logger.png)

### FastGPTã§ã®MiniMind APIåˆ©ç”¨ä¾‹

![images](./images/fastgpt.png)

# ğŸ“Œ è¬è¾

> [!TIP]
> `MiniMind` ãŒå½¹ã«ç«‹ã£ãŸå ´åˆã¯ã€GitHubã®ã‚¹ã‚¿ãƒ¼ï¼ˆâ­ï¼‰ã‚’ä»˜ã‘ã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚  
> ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒé•·ã„ã®ã§ã€ã‚‚ã—èª¤å­—è„±å­—ã‚„æŠ€è¡“çš„ãªãƒŸã‚¹ãŒã‚ã‚Œã°ã€Issueã‚„PRã§ã”æŒ‡æ‘˜ãã ã•ã„ã€‚  
> ã¿ãªã•ã¾ã®ã‚µãƒãƒ¼ãƒˆãŒã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚ˆã‚Šè‰¯ãã—ã¦ã„ãåŸå‹•åŠ›ã§ã™ã€‚

> [!NOTE]
> çš†ã•ã¾ã®å”åŠ›ãŒå¤§ããªåŠ›ã¨ãªã‚Šã¾ã™ã€‚  
> ã‚‚ã—æ–°ãŸãªMiniMindãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’ã•ã‚ŒãŸæ–¹ãŒã„ã‚Œã°ã€Discussionsã‚„Issueã§å…±æœ‰ã—ã¦ã„ãŸã ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚  
> åŒ»ç™‚ã‚„é‡‘èãªã©ã®ç‰¹åŒ–é ˜åŸŸã€ã‚ˆã‚Šå¤§å®¹é‡ã®å­¦ç¿’ã‚„é•·æ–‡å¯¾å¿œãªã©ã€ã‚ã‚‰ã‚†ã‚‹æ‹¡å¼µã‚’æ­“è¿ã—ã¾ã™ã€‚  
> ä»Šå¾Œã€ã“ã¡ã‚‰ã§ã”ç´¹ä»‹ã§ãã‚Œã°ã¨æ€ã„ã¾ã™ã€‚æœ¬å½“ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼

## ğŸ¤[è²¢çŒ®è€…](https://github.com/jingyaogong/minimind/graphs/contributors)

<!--
<a href="https://github.com/jingyaogong/minimind/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=jingyaogong/minimind&v3" />
</a>
-->

<a href="https://github.com/jingyaogong"><img src="https://avatars.githubusercontent.com/u/62287848" width="70px" height="70px"/></a>
&nbsp;
<a href="https://github.com/MuWinds"><img src="https://avatars.githubusercontent.com/u/93832089" width="70px" height="70px"/></a>
&nbsp;
<a href="https://github.com/chuanzhubin"><img src="https://avatars.githubusercontent.com/u/2813798" width="70px" height="70px"/></a>
&nbsp;
<a href="https://github.com/iomgaa-ycz"><img src="https://avatars.githubusercontent.com/u/124225682" width="70px" height="70px"/></a>
&nbsp;

## ğŸ˜Š æ„Ÿè¬

<a href="https://github.com/ipfgao"><b>@ipfgao</b></a>:
<a href="https://github.com/jingyaogong/minimind/issues/26">ğŸ”—å­¦ç¿’æ‰‹é †ã®è¨˜éŒ²</a>

<a href="https://github.com/chuanzhubin"><b>@chuanzhubin</b></a>:
<a href="https://github.com/jingyaogong/minimind/pull/34">ğŸ”—ã‚³ãƒ¼ãƒ‰è¡Œã”ã¨ã®æ³¨é‡ˆ</a>

<a href="https://github.com/WangRongsheng"><b>@WangRongsheng</b></a>:
<a href="https://github.com/jingyaogong/minimind/issues/39">ğŸ”—å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®å‰å‡¦ç†</a>

<a href="https://github.com/pengqianhan"><b>@pengqianhan</b></a>:
<a href="https://github.com/jingyaogong/minimind/issues/73">ğŸ”—ç°¡æ˜“ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</a>

<a href="https://github.com/RyanSunn"><b>@RyanSunn</b></a>:
<a href="https://github.com/jingyaogong/minimind/issues/75">ğŸ”—æ¨è«–éç¨‹ã®å­¦ç¿’ãƒ¡ãƒ¢</a>

<details close> 
<summary> <b>å‚è€ƒãƒªãƒ³ã‚¯ & ç´ æ™´ã‚‰ã—ã„å…ˆè¡Œç ”ç©¶ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</b> </summary>

- é †ä¸åŒ  
- [https://github.com/meta-llama/llama3](https://github.com/meta-llama/llama3)  
- [https://github.com/karpathy/llama2.c](https://github.com/karpathy/llama2.c)  
- [https://github.com/DLLXW/baby-llama2-chinese](https://github.com/DLLXW/baby-llama2-chinese)  
- [(DeepSeek-V2)https://arxiv.org/abs/2405.04434](https://arxiv.org/abs/2405.04434)  
- [https://github.com/charent/ChatLM-mini-Chinese](https://github.com/charent/ChatLM-mini-Chinese)  
- [https://github.com/wdndev/tiny-llm-zh](https://github.com/wdndev/tiny-llm-zh)  
- [(Mistral-MoE)https://arxiv.org/pdf/2401.04088](https://arxiv.org/pdf/2401.04088)  
- [https://github.com/Tongjilibo/build_MiniLLM_from_scratch](https://github.com/Tongjilibo/build_MiniLLM_from_scratch)  
- [https://github.com/jzhang38/TinyLlama](https://github.com/jzhang38/TinyLlama)  
- [https://github.com/AI-Study-Han/Zero-Chatgpt](https://github.com/AI-Study-Han/Zero-Chatgpt)  
- [https://github.com/xusenlinzy/api-for-open-llm](https://github.com/xusenlinzy/api-for-open-llm)  
- [https://github.com/HqWu-HITCS/Awesome-Chinese-LLM](https://github.com/HqWu-HITCS/Awesome-Chinese-LLM)

</details>

## ğŸ«¶ ã‚µãƒãƒ¼ã‚¿ãƒ¼

<a href="https://github.com/jingyaogong/minimind/stargazers">
    <picture>
      <source media="(prefers-color-scheme: dark)" srcset="https://reporoster.com/stars/dark/jingyaogong/minimind"/>
      <source media="(prefers-color-scheme: light)" srcset="https://reporoster.com/stars/jingyaogong/minimind"/>
      <img alt="github contribution grid snake animation" src="https://reporoster.com/stars/jingyaogong/minimind"/>
    </picture>
</a>

<a href="https://github.com/jingyaogong/minimind/network/members">
    <picture>
      <source media="(prefers-color-scheme: dark)" srcset="https://reporoster.com/forks/dark/jingyaogong/minimind"/>
      <source media="(prefers-color-scheme: light)" srcset="https://reporoster.com/forks/jingyaogong/minimind"/>
      <img alt="github contribution grid snake animation" src="https://reporoster.com/forks/jingyaogong/minimind"/>
    </picture>
</a>

<picture>
  <source media="(prefers-color-scheme: dark)" srcset="https://api.star-history.com/svg?repos=jingyaogong/minimind&type=Date&theme=dark"/>
  <source media="(prefers-color-scheme: light)" srcset="https://api.star-history.com/svg?repos=jingyaogong/minimind&type=Date"/>
  <img alt="Star History Chart" src="https://api.star-history.com/svg?repos=jingyaogong/minimind&type=Date"/>
</picture>

# ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ [Apache-2.0 License](LICENSE) ã®ä¸‹ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã•ã‚Œã¦ã„ã¾ã™ã€‚
